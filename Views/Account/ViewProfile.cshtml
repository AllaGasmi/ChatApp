@model ChatAppProj.DTO.ViewProfileDto
@using System.Security.Claims

@{
    ViewData["Title"] = $"{Model.DisplayName}";
    var isOwnProfile = Model.UserId == User.FindFirstValue(ClaimTypes.NameIdentifier);
}

@section Styles {
    <link rel="stylesheet" href="~/css/profile-view.css" asp-append-version="true" />
}

<div class="profile-elegant-container">
    <!-- Back Navigation -->
    <div class="elegant-back">
        <a href="javascript:history.back()" class="back-link-elegant">
            <i class="bi bi-arrow-left"></i> Back
        </a>
    </div>

    <!-- Profile Header -->
    <div class="profile-header-elegant">
        <img src="@Model.ProfilePicture" alt="@Model.DisplayName" class="profile-avatar-elegant"
             onerror="this.src='https://ui-avatars.com/api/?name=@Model.DisplayName&background=667eea&color=fff&size=150'">
        
        <h1 class="profile-name-elegant">@Model.DisplayName</h1>
        
        <div class="profile-status-elegant">
            <span class="status-dot-elegant"></span>
            @Model.Status
        </div>

        <!-- Action Buttons -->
        <div class="actions-elegant">
            @if (Model.CanSendFriendRequest)
            {
                <form asp-controller="Friends" asp-action="SendRequest" method="post" class="d-inline">
                    @Html.AntiForgeryToken()
                    <input type="hidden" name="targetUserId" value="@Model.UserId" />
                    <button type="submit" class="btn-elegant primary">
                        <i class="bi bi-person-add"></i> Connect
                    </button>
                </form>
            }
            else if (Model.HasPendingRequest)
            {
                <button class="btn-elegant secondary" disabled>
                    <i class="bi bi-clock"></i> Request Sent
                </button>
            }
            else if (Model.IsFriend)
            {
                <button class="btn-elegant primary" disabled style="background: #4CAF50;">
                    <i class="bi bi-check"></i> Connected
                </button>
            }
            
            @if (!isOwnProfile)
            {
                <a asp-controller="Chat" asp-action="StartChat" asp-route-userId="@Model.UserId" 
                   class="btn-elegant secondary">
                    <i class="bi bi-chat"></i> Message
                </a>
            }
            else
            {
                <a asp-controller="Account" asp-action="Profile" class="btn-elegant primary">
                    <i class="bi bi-pencil"></i> Edit Profile
                </a>
            }
        </div>
    </div>

    <!-- Profile Content -->
    <div class="profile-content-elegant">
        <!-- About Section -->
        <div class="about-section-elegant">
            <h3 class="section-title-elegant">
                <i class="bi bi-info-circle section-icon"></i>
                About
            </h3>
            
            @if (!string.IsNullOrEmpty(Model.Bio))
            {
                <div class="bio-content-elegant">
                    @Model.Bio
                </div>
            }
            else
            {
                <div class="no-bio-elegant">
                    <i class="bi bi-journal no-bio-icon"></i>
                    <p>No bio provided</p>
                    @if (isOwnProfile)
                    {
                        <a asp-controller="Account" asp-action="Profile" class="btn-elegant secondary" style="margin-top: 1rem;">
                            <i class="bi bi-plus"></i> Add Bio
                        </a>
                    }
                </div>
            }
        </div>

        <!-- Details Section -->
        <div class="details-section-elegant">
            <h3 class="section-title-elegant">
                <i class="bi bi-person-badge section-icon"></i>
                Details
            </h3>
            
            <div class="detail-item-elegant">
                <div class="detail-icon-elegant">
                    <i class="bi bi-person"></i>
                </div>
                <div class="detail-content-elegant">
                    <div class="detail-label">Name</div>
                    <div class="detail-value">@Model.DisplayName</div>
                </div>
            </div>
            
            @if (!string.IsNullOrEmpty(Model.Email) && isOwnProfile)
            {
                <div class="detail-item-elegant">
                    <div class="detail-icon-elegant">
                        <i class="bi bi-envelope"></i>
                    </div>
                    <div class="detail-content-elegant">
                        <div class="detail-label">Email</div>
                        <div class="detail-value">@Model.Email</div>
                    </div>
                </div>
            }
            
            @if (Model.CreatedAt.HasValue)
            {
                <div class="detail-item-elegant">
                    <div class="detail-icon-elegant">
                        <i class="bi bi-calendar"></i>
                    </div>
                    <div class="detail-content-elegant">
                        <div class="detail-label">Member Since</div>
                        <div class="detail-value">@Model.CreatedAt.Value.ToString("MMMM yyyy")</div>
                    </div>
                </div>
            }
            
            <div class="detail-item-elegant">
                <div class="detail-icon-elegant">
                    <i class="bi bi-people"></i>
                </div>
                <div class="detail-content-elegant">
                    <div class="detail-label">Connection</div>
                    <div class="detail-value">
                        @if (Model.IsFriend)
                        {
                            <span class="connection-status-elegant status-connected">
                                <i class="bi bi-check"></i> Friends
                            </span>
                        }
                        else if (Model.HasPendingRequest)
                        {
                            <span class="connection-status-elegant status-pending">
                                <i class="bi bi-clock"></i> Request Pending
                            </span>
                        }
                        else if (!isOwnProfile)
                        {
                            <span class="connection-status-elegant status-available">
                                <i class="bi bi-person-plus"></i> Available to Connect
                            </span>
                        }
                        else
                        {
                            <span>Your Profile</span>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Smooth status dot animation
            const statusDot = document.querySelector('.status-dot-elegant');
            const statusText = '@Model.Status';
            
            if (statusText.includes('Offline') || statusText.includes('Last seen')) {
                if (statusDot) {
                    statusDot.style.background = '#999';
                    statusDot.style.animation = 'none';
                }
            } else if (statusText.includes('Online')) {
                if (statusDot) {
                    statusDot.style.animation = 'pulse 2s infinite';
                }
            }
            
            // Add friend button loading state
            const addFriendBtn = document.querySelector('form button[type="submit"]');
            if (addFriendBtn) {
                addFriendBtn.addEventListener('click', function() {
                    const originalHTML = this.innerHTML;
                    this.innerHTML = '<i class="bi bi-hourglass-split me-2"></i> Sending...';
                    this.disabled = true;
                    
                    setTimeout(() => {
                        this.closest('form').submit();
                    }, 500);
                });
            }
            
            // Message button loading state
            const messageBtn = document.querySelector('.btn-elegant.secondary[href*="StartChat"]');
            if (messageBtn) {
                messageBtn.addEventListener('click', function() {
                    const originalHTML = this.innerHTML;
                    this.innerHTML = '<i class="bi bi-hourglass-split me-2"></i> Opening...';
                });
            }
            
            // Add subtle hover effects to cards
            const cards = document.querySelectorAll('.about-section-elegant, .details-section-elegant');
            cards.forEach(card => {
                card.addEventListener('mouseenter', () => {
                    card.style.transform = 'translateY(-2px)';
                    card.style.boxShadow = '0 6px 25px rgba(0,0,0,0.08)';
                });
                
                card.addEventListener('mouseleave', () => {
                    card.style.transform = 'translateY(0)';
                    card.style.boxShadow = '0 4px 20px rgba(0,0,0,0.05)';
                });
            });
        });
        
    </script>
}